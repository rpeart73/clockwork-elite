<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Clockwork Elite - Intelligent Task & Case Note Generator v5.0 with AI</title>
    <style>
        * {
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
            line-height: 1.6;
            height: 100vh;
            overflow: hidden;
        }
        
        /* Main Layout */
        .app-container {
            display: flex;
            height: 100vh;
        }
        
        /* Left Panel - Main App */
        .main-panel {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }
        
        /* Right Panel - AI Chat */
        .ai-panel {
            width: 400px;
            background: white;
            border-left: 1px solid #e0e0e0;
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease;
        }
        
        .ai-panel.collapsed {
            width: 0;
            overflow: hidden;
        }
        
        /* AI Chat Header */
        .ai-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            min-height: 80px;
        }
        
        .ai-header h3 {
            margin: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .ai-toggle {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.3s ease;
        }
        
        .ai-toggle:hover {
            background: rgba(255,255,255,0.3);
        }
        
        /* AI Messages Area */
        .ai-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: #f8f9fa;
        }
        
        .ai-message {
            margin-bottom: 15px;
            display: flex;
            gap: 10px;
            animation: fadeIn 0.3s ease;
        }
        
        .ai-message.user {
            flex-direction: row-reverse;
        }
        
        .ai-message-content {
            max-width: 80%;
            padding: 12px 16px;
            border-radius: 12px;
            font-size: 14px;
            line-height: 1.5;
        }
        
        .ai-message.assistant .ai-message-content {
            background: white;
            color: #333;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        
        .ai-message.user .ai-message-content {
            background: #667eea;
            color: white;
        }
        
        /* AI Input Area */
        .ai-input-area {
            padding: 20px;
            background: white;
            border-top: 1px solid #e0e0e0;
        }
        
        .ai-input-wrapper {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .ai-input {
            flex: 1;
            padding: 12px 16px;
            border: 1px solid #ddd;
            border-radius: 25px;
            font-size: 14px;
            outline: none;
            transition: all 0.3s ease;
        }
        
        .ai-input:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .ai-send {
            background: #667eea;
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .ai-send:hover {
            background: #5a67d8;
            transform: scale(1.05);
        }
        
        .ai-send:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        /* AI Setup */
        .ai-setup {
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
            margin: 20px;
        }
        
        .ai-setup h4 {
            margin-top: 0;
            color: #333;
        }
        
        .ai-setup input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 6px;
        }
        
        .ai-setup button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .ai-setup button:hover {
            background: #5a67d8;
        }
        
        /* Toggle Button when collapsed */
        .ai-fab {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: none;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            z-index: 999;
        }
        
        .ai-fab:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 30px rgba(0,0,0,0.3);
        }
        
        .ai-panel.collapsed + .ai-fab {
            display: flex;
        }
        
        /* Main App Styles */
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        h1 {
            font-size: 2.5em;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .version-badge {
            font-size: 0.4em;
            background: rgba(255,255,255,0.2);
            padding: 4px 12px;
            border-radius: 20px;
            font-weight: normal;
        }
        
        .content-area {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        textarea {
            width: 100%;
            min-height: 200px;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            font-family: inherit;
            resize: vertical;
            transition: all 0.3s ease;
        }
        
        textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #374151;
        }
        
        input[type="text"], select {
            width: 100%;
            padding: 10px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            font-size: 14px;
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        
        .primary-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .primary-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        
        .secondary-button {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .secondary-button:hover {
            background: #667eea;
            color: white;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Responsive */
        @media (max-width: 1024px) {
            .ai-panel {
                width: 350px;
            }
        }
        
        @media (max-width: 768px) {
            .app-container {
                flex-direction: column;
            }
            
            .ai-panel {
                width: 100%;
                height: 50vh;
                border-left: none;
                border-top: 1px solid #e0e0e0;
            }
            
            .ai-panel.collapsed {
                height: 0;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Main Panel -->
        <div class="main-panel">
            <div class="container">
                <div class="header">
                    <h1>
                        ⚡ Clockwork Elite
                        <span class="version-badge">v5.0 AI</span>
                    </h1>
                    <div style="margin-top: 10px; opacity: 0.9;">Intelligent Task & Case Note Generator with AI Assistant</div>
                </div>
                
                <div class="content-area">
                    <div class="form-group">
                        <label for="emailContent">📝 Enter Your Content</label>
                        <textarea id="emailContent" placeholder="Paste email content, meeting notes, or any text here...">Following up on our discussion from Monday about the assignment deadline. The student expressed concerns about completing the research paper on time due to personal circumstances. We reviewed the requirements and created an action plan together.</textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="studentName">👤 Student Name</label>
                        <input type="text" id="studentName" placeholder="First name only">
                    </div>
                    
                    <div class="form-group">
                        <label for="noteStyle">📋 Note Style</label>
                        <select id="noteStyle">
                            <option value="natural" selected>Natural Narrative</option>
                            <option value="bullet">Bullet Points</option>
                        </select>
                    </div>
                    
                    <div class="button-group">
                        <button class="primary-button" onclick="generateNotes()">
                            Generate Case Note
                        </button>
                        <button class="secondary-button" onclick="clearForm()">
                            Clear
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- AI Panel -->
        <div class="ai-panel" id="aiPanel">
            <div class="ai-header">
                <h3>
                    🤖 AI Assistant
                    <span style="font-size: 12px; opacity: 0.8; margin-left: 10px;">Powered by Claude Opus 4</span>
                </h3>
                <button class="ai-toggle" onclick="toggleAIPanel()">×</button>
            </div>
            <div class="ai-messages" id="aiMessages">
                <!-- Messages will appear here -->
            </div>
            <div class="ai-input-area">
                <div class="ai-input-wrapper">
                    <input type="text" class="ai-input" id="aiInput" placeholder="Ask me anything about case notes..." onkeypress="handleAIKeypress(event)">
                    <button class="ai-send" onclick="sendAIMessage()" id="aiSendBtn">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                            <path d="m22 2-7 20-4-9-9-4Z"/>
                            <path d="M22 2 11 13"/>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Floating AI Button (shown when panel is collapsed) -->
    <div class="ai-fab" onclick="toggleAIPanel()" title="AI Assistant">
        <svg width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
            <path d="M12 2a2 2 0 0 1 2 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 0 1 7 7h1a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1.07A8 8 0 0 1 13 22h-2A8 8 0 0 1 3.07 19H2a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h1a7 7 0 0 1 7-7h1V5.73A2 2 0 1 1 12 2Z"/>
        </svg>
    </div>
    
    <script>
        // AI Assistant Functions
        let aiApiKey = null;
        let aiMessages = [];
        
        function initializeAI() {
            // Check if API key exists
            aiApiKey = localStorage.getItem('claude_api_key');
            
            if (!aiApiKey) {
                aiMessages.push({
                    role: 'assistant',
                    content: `Welcome! I'm your AI assistant for Clockwork Elite. To get started, I'll need your Claude API key.\n\nClick the button below to set it up.`
                });
                displayAIMessages();
                showAPIKeySetup();
            } else {
                aiMessages.push({
                    role: 'assistant',
                    content: 'Hi! I\'m powered by Claude Opus 4 - the most advanced AI model. I can help you write exceptional case notes with nuanced understanding and professional language.\n\nTry asking me:\n• "Analyze this email for key points"\n• "Help me write a comprehensive case note"\n• "What important details am I missing?"\n• "Make this more professional and detailed"'
                });
                displayAIMessages();
            }
        }
        
        function toggleAIPanel() {
            const panel = document.getElementById('aiPanel');
            panel.classList.toggle('collapsed');
        }
        
        function showAPIKeySetup() {
            const messagesDiv = document.getElementById('aiMessages');
            const setupDiv = document.createElement('div');
            setupDiv.className = 'ai-setup';
            setupDiv.innerHTML = `
                <h4>🔐 Setup Claude API Key</h4>
                <p>Your key is stored securely in your browser only.</p>
                <input type="password" id="apiKeyInput" placeholder="sk-ant-api..." />
                <button onclick="saveAPIKey()">Save API Key</button>
                <p style="margin-top: 10px; font-size: 12px; color: #666;">
                    <a href="https://console.anthropic.com/settings/keys" target="_blank" style="color: #667eea;">Get your API key here →</a>
                </p>
            `;
            messagesDiv.appendChild(setupDiv);
        }
        
        function saveAPIKey() {
            const keyInput = document.getElementById('apiKeyInput');
            const key = keyInput.value.trim();
            
            if (key && key.startsWith('sk-ant-')) {
                aiApiKey = key;
                localStorage.setItem('claude_api_key', key);
                
                // Remove setup div
                const setupDiv = document.querySelector('.ai-setup');
                if (setupDiv) setupDiv.remove();
                
                // Add success message
                aiMessages.push({
                    role: 'assistant',
                    content: 'Great! Your API key is saved. How can I help you with Clockwork Elite?'
                });
                displayAIMessages();
            } else {
                alert('Please enter a valid Claude API key starting with sk-ant-');
            }
        }
        
        function displayAIMessages() {
            const messagesDiv = document.getElementById('aiMessages');
            messagesDiv.innerHTML = '';
            
            aiMessages.forEach(msg => {
                const messageDiv = document.createElement('div');
                messageDiv.className = `ai-message ${msg.role}`;
                
                const contentDiv = document.createElement('div');
                contentDiv.className = 'ai-message-content';
                contentDiv.innerHTML = msg.content.replace(/\n/g, '<br>');
                
                messageDiv.appendChild(contentDiv);
                messagesDiv.appendChild(messageDiv);
            });
            
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }
        
        async function sendAIMessage() {
            const input = document.getElementById('aiInput');
            const sendBtn = document.getElementById('aiSendBtn');
            const message = input.value.trim();
            
            if (!message) return;
            
            if (!aiApiKey) {
                alert('Please set up your API key first');
                return;
            }
            
            // Add user message
            aiMessages.push({ role: 'user', content: message });
            displayAIMessages();
            
            // Clear input and disable
            input.value = '';
            input.disabled = true;
            sendBtn.disabled = true;
            
            // Get current context
            const context = {
                emailContent: document.getElementById('emailContent').value,
                studentName: document.getElementById('studentName').value,
                noteStyle: document.getElementById('noteStyle').value
            };
            
            try {
                const response = await fetch('https://api.anthropic.com/v1/messages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'x-api-key': aiApiKey,
                        'anthropic-version': '2023-06-01'
                    },
                    body: JSON.stringify({
                        model: 'claude-3-opus-20240229',
                        max_tokens: 4000,
                        messages: [
                            {
                                role: 'user',
                                content: `You are an AI assistant for Clockwork Elite, a case note and task generator. Current context:\n\nContent: ${context.emailContent || 'No content yet'}\nStudent Name: ${context.studentName || 'Not specified'}\nNote Style: ${context.noteStyle}\n\nUser question: ${message}\n\nProvide helpful, specific advice about writing case notes, using the tool, or improving their content. Be concise and practical.`
                            }
                        ]
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    aiMessages.push({
                        role: 'assistant',
                        content: data.content[0].text
                    });
                } else {
                    throw new Error('API request failed');
                }
            } catch (error) {
                console.error('AI Error:', error);
                aiMessages.push({
                    role: 'assistant',
                    content: 'Sorry, I encountered an error. Please check your API key and try again.'
                });
            }
            
            displayAIMessages();
            input.disabled = false;
            sendBtn.disabled = false;
            input.focus();
        }
        
        function handleAIKeypress(event) {
            if (event.key === 'Enter') {
                sendAIMessage();
            }
        }
        
        // Main App Functions
        function generateNotes() {
            const content = document.getElementById('emailContent').value;
            const studentName = document.getElementById('studentName').value;
            const noteStyle = document.getElementById('noteStyle').value;
            
            if (!content) {
                alert('Please enter some content first');
                return;
            }
            
            // Simple case note generation
            let output = '';
            
            if (noteStyle === 'natural') {
                output = `Case Note - ${new Date().toLocaleDateString()}\n\n`;
                output += `I provided support to ${studentName || '[Student Name]'} regarding their academic concerns. `;
                output += `${content}\n\n`;
                output += `The student appeared receptive to the guidance provided and we established clear next steps for moving forward.`;
            } else {
                output = `Case Note - ${new Date().toLocaleDateString()}\n\n`;
                output += `Student: ${studentName || '[Student Name]'}\n\n`;
                output += `Key Points:\n`;
                output += `• Discussed academic concerns\n`;
                output += `• Reviewed requirements and expectations\n`;
                output += `• Created action plan for completion\n`;
                output += `• Scheduled follow-up meeting\n\n`;
                output += `Notes: ${content}`;
            }
            
            // Show output in alert (you can replace with modal)
            alert(output);
            
            // Suggest using AI
            if (aiApiKey && aiMessages.length < 3) {
                aiMessages.push({
                    role: 'assistant',
                    content: 'I noticed you just generated a case note. Would you like me to review it and suggest improvements?'
                });
                displayAIMessages();
            }
        }
        
        function clearForm() {
            document.getElementById('emailContent').value = '';
            document.getElementById('studentName').value = '';
            document.getElementById('noteStyle').value = 'natural';
        }
        
        // Initialize on load
        document.addEventListener('DOMContentLoaded', function() {
            initializeAI();
        });
    </script>
</body>
</html>